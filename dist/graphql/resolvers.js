"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _index = _interopRequireDefault(require("../firebase/index.js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = {
  Query: {
    getAllFilms: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("films").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data;
      });
    },
    getAllPersons: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data;
      });
    },
    getProducers: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.filter(p => {
          return p.type === "producer";
        });
      });
    },
    getActers: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.filter(p => {
          return p.type === "acter";
        });
      }); // return getData().then( () => { return data.persons.filter( (p) => { return p.type === "acter" } ) } )
    },
    getPerson: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child(`/persons/${params.id}`).get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data;
      });
    },
    getFilm: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child(`/films/${params.id}`).get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data;
      }); // return getData().then( () => { return data.films.find( ({ id }) => { return id === params.id } ) } )
    },
    getAllTimes: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("times").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data;
      }); // return getData().then( () => { return data.times } )
    },
    getTime: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("times").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.find(({
          id
        }) => {
          return id === params.id;
        });
      }); // return getData().then( () => { return data.times.find( ({ id }) => { return id === params.id } ) } )
    }
  }
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ncmFwaHFsL3Jlc29sdmVycy5qcyJdLCJuYW1lcyI6WyJRdWVyeSIsImdldEFsbEZpbG1zIiwiZGF0YSIsImdldERhdGEiLCJkYXRhYmFzZSIsInJlZiIsImNoaWxkIiwiZ2V0IiwidGhlbiIsInMiLCJleGlzdHMiLCJ2YWwiLCJjYXRjaCIsImVycm9yIiwiY29uc29sZSIsImdldEFsbFBlcnNvbnMiLCJnZXRQcm9kdWNlcnMiLCJmaWx0ZXIiLCJwIiwidHlwZSIsImdldEFjdGVycyIsImdldFBlcnNvbiIsIl8iLCJwYXJhbXMiLCJpZCIsImdldEZpbG0iLCJnZXRBbGxUaW1lcyIsImdldFRpbWUiLCJmaW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7ZUFFZTtBQUNYQSxFQUFBQSxLQUFLLEVBQUU7QUFDSEMsSUFBQUEsV0FBVyxFQUFFLE1BQU07QUFFZixVQUFJQyxJQUFKOztBQUVBLFlBQU1DLE9BQU8sR0FBRyxZQUFZO0FBQ3hCLGNBQU1DLGVBQVNDLEdBQVQsR0FBZUMsS0FBZixDQUFxQixPQUFyQixFQUE4QkMsR0FBOUIsR0FDTEMsSUFESyxDQUVEQyxDQUFELElBQU87QUFBRSxjQUFLQSxDQUFDLENBQUNDLE1BQUYsRUFBTCxFQUFrQjtBQUFHUixZQUFBQSxJQUFJLEdBQUdPLENBQUMsQ0FBQ0UsR0FBRixFQUFQO0FBQWdCO0FBQUUsU0FGOUMsRUFJTEMsS0FKSyxDQUlHQyxLQUFELElBQVc7QUFBRUMsVUFBQUEsT0FBTyxDQUFDRCxLQUFSLENBQWNBLEtBQWQ7QUFBc0IsU0FKckMsQ0FBTjtBQUtILE9BTkQ7O0FBUUEsYUFBT1YsT0FBTyxHQUFHSyxJQUFWLENBQWdCLE1BQU07QUFBRSxlQUFPTixJQUFQO0FBQWEsT0FBckMsQ0FBUDtBQUNILEtBZEU7QUFnQkhhLElBQUFBLGFBQWEsRUFBRSxNQUFNO0FBRWpCLFVBQUliLElBQUo7O0FBRUEsWUFBTUMsT0FBTyxHQUFHLFlBQVk7QUFDeEIsY0FBTUMsZUFBU0MsR0FB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T0FORDs7QUFRQSxhQUFPVixPQUFPLEdBQUdLLElBQVYsQ0FBZ0IsTUFBTTtBQUFFLGVBQU9OLElBQVA7QUFBYSxPQUFyQyxDQUFQLENBWmUsQ0FjZjtBQUNILEtBOUdFO0FBZ0hIeUIsSUFBQUEsT0FBTyxFQUFFLENBQUVMLENBQUYsRUFBS0MsTUFBTCxLQUFpQjtBQUV0QixVQUFJckIsSUFBSjs7QUFFQSxZQUFNQyxPQUFPLEdBQUcsWUFBWTtBQUN4QixjQUFNQyxlQUFTQyxHQUFULEdBQWVDLEtBQWYsQ0FBcUIsT0FBckIsRUFBOEJDLEdBQTlCLEdBQ0xDLElBREssQ0FFREMsQ0FBRCxJQUFPO0FBQUUsY0FBS0EsQ0FBQyxDQUFDQyxNQUFGLEVBQUwsRUFBa0I7QUFBR1IsWUFBQUEsSUFBSSxHQUFHTyxDQUFDLENBQUNFLEdBQUYsRUFBUDtBQUFnQjtBQUFFLFNBRjlDLEVBSUxDLEtBSkssQ0FJR0MsS0FBRCxJQUFXO0FBQUVDLFVBQUFBLE9BQU8sQ0FBQ0QsS0FBUixDQUFjQSxLQUFkO0FBQXNCLFNBSnJDLENBQU47QUFLSCxPQU5EOztBQVFBLGFBQU9WLE9BQU8sR0FBR0ssSUFBVixDQUFnQixNQUFNO0FBQUUsZUFBT04sSUFBSSxDQUFDMEIsSUFBTCxDQUFXLENBQUM7QUFBRUosVUFBQUE7QUFBRixTQUFELEtBQVk7QUFBRSxpQkFBT0EsRUFBRSxLQUFLRCxNQUFNLENBQUNDLEVBQXJCO0FBQXlCLFNBQWxELENBQVA7QUFBNkQsT0FBckYsQ0FBUCxDQVpzQixDQWN0QjtBQUNIO0FBL0hFO0FBREksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkYXRhYmFzZSBmcm9tIFwiLi4vZmlyZWJhc2UvaW5kZXguanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIFF1ZXJ5OiB7XHJcbiAgICAgICAgZ2V0QWxsRmlsbXM6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoXCJmaWxtc1wiKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YSB9IClcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgZ2V0QWxsUGVyc29uczogKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGFcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdldERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkYXRhYmFzZS5yZWYoKS5jaGlsZChcInBlcnNvbnNcIikuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKCBcclxuICAgICAgICAgICAgICAgICAgICAocykgPT4geyBpZiAoIHMuZXhpc3RzKCkgKSB7ICBkYXRhID0gcy52YWwoKSB9IH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5jYXRjaCggKGVycm9yKSA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyb3IpIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZ2V0RGF0YSgpLnRoZW4oICgpID0+IHsgcmV0dXJuIGRhdGEgfSApXHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIGdldFByb2R1Y2VyczogKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGFcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdldERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkYXRhYmFzZS5yZWYoKS5jaGlsZChcInBlcnNvbnNcIikuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKCBcclxuICAgICAgICAgICAgICAgICAgICAocykgPT4geyBpZiAoIHMuZXhpc3RzKCkgKSB7ICBkYXRhID0gcy52YWwoKSB9IH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5jYXRjaCggKGVycm9yKSA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyb3IpIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZ2V0RGF0YSgpLnRoZW4oICgpID0+IHsgcmV0dXJuIGRhdGEuZmlsdGVyKCAocCkgPT4geyByZXR1cm4gcC50eXBlID09PSBcInByb2R1Y2VyXCIgfSApIH0gKVxyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBnZXRBY3RlcnM6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoXCJwZXJzb25zXCIpLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgICAgKHMpID0+IHsgaWYgKCBzLmV4aXN0cygpICkgeyAgZGF0YSA9IHMudmFsKCkgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goIChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKGVycm9yKSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiB7IHJldHVybiBkYXRhLmZpbHRlciggKHApID0+IHsgcmV0dXJuIHAudHlwZSA9PT0gXCJhY3RlclwiIH0gKSB9IClcclxuXHJcbiAgICAgICAgICAgIC8vIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YS5wZXJzb25zLmZpbHRlciggKHApID0+IHsgcmV0dXJuIHAudHlwZSA9PT0gXCJhY3RlclwiIH0gKSB9IClcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgZ2V0UGVyc29uOiAoIF8sIHBhcmFtcyApID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoYC9wZXJzb25zLyR7cGFyYW1zLmlkfWApLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgICAgKHMpID0+IHsgaWYgKCBzLmV4aXN0cygpICkgeyAgZGF0YSA9IHMudmFsKCkgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goIChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKGVycm9yKSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiB7IHJldHVybiBkYXRhIH0gKVxyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBnZXRGaWxtOiAoIF8sIHBhcmFtcyApID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoYC9maWxtcy8ke3BhcmFtcy5pZH1gKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YSB9IClcclxuXHJcbiAgICAgICAgICAgIC8vIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YS5maWxtcy5maW5kKCAoeyBpZCB9KSA9PiB7IHJldHVybiBpZCA9PT0gcGFyYW1zLmlkIH0gKSB9IClcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgZ2V0QWxsVGltZXM6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoXCJ0aW1lc1wiKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YSB9IClcclxuXHJcbiAgICAgICAgICAgIC8vIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YS50aW1lcyB9IClcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIGdldFRpbWU6ICggXywgcGFyYW1zICkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGFcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdldERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkYXRhYmFzZS5yZWYoKS5jaGlsZChcInRpbWVzXCIpLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgICAgKHMpID0+IHsgaWYgKCBzLmV4aXN0cygpICkgeyAgZGF0YSA9IHMudmFsKCkgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goIChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKGVycm9yKSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiB7IHJldHVybiBkYXRhLmZpbmQoICh7IGlkIH0pID0+IHsgcmV0dXJuIGlkID09PSBwYXJhbXMuaWQgfSApIH0gKVxyXG5cclxuICAgICAgICAgICAgLy8gcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiB7IHJldHVybiBkYXRhLnRpbWVzLmZpbmQoICh7IGlkIH0pID0+IHsgcmV0dXJuIGlkID09PSBwYXJhbXMuaWQgfSApIH0gKVxyXG4gICAgICAgIH1cclxuICAgIH0gXHJcbn0iXX0=