"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _index = _interopRequireDefault(require("../firebase/index.js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = {
  Query: {
    getAllFilms: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("films").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => data);
    },
    getAllPersons: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => data);
    },
    getProducers: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.filter(p => {
          return p.type === "producer";
        });
      });
    },
    getActers: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("persons").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.filter(p => {
          return p.type === "acter";
        });
      });
    },
    getPerson: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child(`/persons/${params.id}`).get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => data);
    },
    getFilm: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child(`/films/${params.id}`).get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => data);
    },
    getAllTimes: () => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("times").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => data);
    },
    getTime: (_, params) => {
      let data;

      const getData = async () => {
        await _index.default.ref().child("times").get().then(s => {
          if (s.exists()) {
            data = s.val();
          }
        }).catch(error => {
          console.error(error);
        });
      };

      return getData().then(() => {
        return data.find(({
          id
        }) => {
          return id === params.id;
        });
      });
    }
  }
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ncmFwaHFsL3Jlc29sdmVycy5qcyJdLCJuYW1lcyI6WyJRdWVyeSIsImdldEFsbEZpbG1zIiwiZGF0YSIsImdldERhdGEiLCJkYXRhYmFzZSIsInJlZiIsImNoaWxkIiwiZ2V0IiwidGhlbiIsInMiLCJleGlzdHMiLCJ2YWwiLCJjYXRjaCIsImVycm9yIiwiY29uc29sZSIsImdldEFsbFBlcnNvbnMiLCJnZXRQcm9kdWNlcnMiLCJmaWx0ZXIiLCJwIiwidHlwZSIsImdldEFjdGVycyIsImdldFBlcnNvbiIsIl8iLCJwYXJhbXMiLCJpZCIsImdldEZpbG0iLCJnZXRBbGxUaW1lcyIsImdldFRpbWUiLCJmaW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7ZUFFZTtBQUNYQSxFQUFBQSxLQUFLLEVBQUU7QUFDSEMsSUFBQUEsV0FBVyxFQUFFLE1BQU07QUFFZixVQUFJQyxJQUFKOztBQUVBLFlBQU1DLE9BQU8sR0FBRyxZQUFZO0FBQ3hCLGNBQU1DLGVBQVNDLEdBQVQsR0FBZUMsS0FBZixDQUFxQixPQUFyQixFQUE4QkMsR0FBOUIsR0FDTEMsSUFESyxDQUVEQyxDQUFELElBQU87QUFBRSxjQUFLQSxDQUFDLENBQUNDLE1BQUYsRUFBTCxFQUFrQjtBQUFHUixZQUFBQSxJQUFJLEdBQUdPLENBQUMsQ0FBQ0UsR0FBRixFQUFQO0FBQWdCO0FBQUUsU0FGOUMsRUFJTEMsS0FKSyxDQUlHQyxLQUFELElBQVc7QUFBRUMsVUFBQUEsT0FBTyxDQUFDRCxLQUFSLENBQWNBLEtBQWQ7QUFBc0IsU0FKckMsQ0FBTjtBQUtILE9BTkQ7O0FBUUEsYUFBT1YsT0FBTyxHQUFHSyxJQUFWLENBQWdCLE1BQU1OLElBQXRCLENBQVA7QUFDSCxLQWRFO0FBZ0JIYSxJQUFBQSxhQUFhLEVBQUUsTUFBTTtBQUVqQixVQUFJYixJQUFKOztBQUVBLFlBQU1DLE9BQU8sR0FBRyxZQUFZO0FBQ3hCLGNBQU1DLGVBQVNDLEdBQVQsR0FBZUMsS0FBZixDQUFxQixT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RUFBS0MsTUFBTCxLQUFpQjtBQUV0QixVQUFJckIsSUFBSjs7QUFFQSxZQUFNQyxPQUFPLEdBQUcsWUFBWTtBQUN4QixjQUFNQyxlQUFTQyxHQUFULEdBQWVDLEtBQWYsQ0FBcUIsT0FBckIsRUFBOEJDLEdBQTlCLEdBQ0xDLElBREssQ0FFREMsQ0FBRCxJQUFPO0FBQUUsY0FBS0EsQ0FBQyxDQUFDQyxNQUFGLEVBQUwsRUFBa0I7QUFBR1IsWUFBQUEsSUFBSSxHQUFHTyxDQUFDLENBQUNFLEdBQUYsRUFBUDtBQUFnQjtBQUFFLFNBRjlDLEVBSUxDLEtBSkssQ0FJR0MsS0FBRCxJQUFXO0FBQUVDLFVBQUFBLE9BQU8sQ0FBQ0QsS0FBUixDQUFjQSxLQUFkO0FBQXNCLFNBSnJDLENBQU47QUFLSCxPQU5EOztBQVFBLGFBQU9WLE9BQU8sR0FBR0ssSUFBVixDQUFnQixNQUFNO0FBQUUsZUFBT04sSUFBSSxDQUFDMEIsSUFBTCxDQUFXLENBQUM7QUFBRUosVUFBQUE7QUFBRixTQUFELEtBQVk7QUFBRSxpQkFBT0EsRUFBRSxLQUFLRCxNQUFNLENBQUNDLEVBQXJCO0FBQXlCLFNBQWxELENBQVA7QUFBNkQsT0FBckYsQ0FBUDtBQUNIO0FBdkhFO0FBREksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkYXRhYmFzZSBmcm9tIFwiLi4vZmlyZWJhc2UvaW5kZXguanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIFF1ZXJ5OiB7XHJcbiAgICAgICAgZ2V0QWxsRmlsbXM6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZ2V0RGF0YSA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGRhdGFiYXNlLnJlZigpLmNoaWxkKFwiZmlsbXNcIikuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKCBcclxuICAgICAgICAgICAgICAgICAgICAocykgPT4geyBpZiAoIHMuZXhpc3RzKCkgKSB7ICBkYXRhID0gcy52YWwoKSB9IH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5jYXRjaCggKGVycm9yKSA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyb3IpIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZ2V0RGF0YSgpLnRoZW4oICgpID0+IGRhdGEgKVxyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBnZXRBbGxQZXJzb25zOiAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZGF0YTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdldERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkYXRhYmFzZS5yZWYoKS5jaGlsZChcInBlcnNvbnNcIikuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKCBcclxuICAgICAgICAgICAgICAgICAgICAocykgPT4geyBpZiAoIHMuZXhpc3RzKCkgKSB7ICBkYXRhID0gcy52YWwoKSB9IH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5jYXRjaCggKGVycm9yKSA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyb3IpIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZ2V0RGF0YSgpLnRoZW4oICgpID0+IGRhdGEgKVxyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBnZXRQcm9kdWNlcnM6ICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZ2V0RGF0YSA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGRhdGFiYXNlLnJlZigpLmNoaWxkKFwicGVyc29uc1wiKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YS5maWx0ZXIoIChwKSA9PiB7IHJldHVybiBwLnR5cGUgPT09IFwicHJvZHVjZXJcIiB9ICkgfSApXHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIGdldEFjdGVyczogKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGE7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoXCJwZXJzb25zXCIpLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgICAgKHMpID0+IHsgaWYgKCBzLmV4aXN0cygpICkgeyAgZGF0YSA9IHMudmFsKCkgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goIChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKGVycm9yKSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiB7IHJldHVybiBkYXRhLmZpbHRlciggKHApID0+IHsgcmV0dXJuIHAudHlwZSA9PT0gXCJhY3RlclwiIH0gKSB9IClcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgZ2V0UGVyc29uOiAoIF8sIHBhcmFtcyApID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZ2V0RGF0YSA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGRhdGFiYXNlLnJlZigpLmNoaWxkKGAvcGVyc29ucy8ke3BhcmFtcy5pZH1gKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4gZGF0YSApXHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIGdldEZpbG06ICggXywgcGFyYW1zICkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGE7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoYC9maWxtcy8ke3BhcmFtcy5pZH1gKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4gZGF0YSApXHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIGdldEFsbFRpbWVzOiAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZGF0YTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdldERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkYXRhYmFzZS5yZWYoKS5jaGlsZChcInRpbWVzXCIpLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgICAgKHMpID0+IHsgaWYgKCBzLmV4aXN0cygpICkgeyAgZGF0YSA9IHMudmFsKCkgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goIChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKGVycm9yKSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdldERhdGEoKS50aGVuKCAoKSA9PiBkYXRhIClcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIGdldFRpbWU6ICggXywgcGFyYW1zICkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGE7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGF0YWJhc2UucmVmKCkuY2hpbGQoXCJ0aW1lc1wiKS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oIFxyXG4gICAgICAgICAgICAgICAgICAgIChzKSA9PiB7IGlmICggcy5leGlzdHMoKSApIHsgIGRhdGEgPSBzLnZhbCgpIH0gfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKCAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihlcnJvcikgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBnZXREYXRhKCkudGhlbiggKCkgPT4geyByZXR1cm4gZGF0YS5maW5kKCAoeyBpZCB9KSA9PiB7IHJldHVybiBpZCA9PT0gcGFyYW1zLmlkIH0gKSB9IClcclxuICAgICAgICB9XHJcbiAgICB9IFxyXG59Il19